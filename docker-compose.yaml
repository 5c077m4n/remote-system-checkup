version: "3"
services:
    amqp:
        image: rabbitmq:3.7-alpine
        restart: always

    back:
        depends_on:
            - amqp
        image: node:latest
        volumes:
            - ./packages/back:/usr/app
        ports:
            - 3000:3000
        command: >
            sh -c "cd /usr/app/ &&
                npm ci &&
                npm run build &&
                npm run start:prod"
        restart: always
    # front:
    #     depends_on:
    #         - back
    #     image: nginx:stable
    #     ports:
    #         - 80:80
    #         - 443:443
    #     volumes:
    #         - ./packages/front/dist:/usr/share/nginx/html
    #     restart: always
